# AtelierX - ソフトウェア仕様書

## 概要

AtelierX は、OS上のウィンドウをカンバンボードで視覚的に管理するデスクトップアプリケーション。Terminal、Finder、ブラウザ、エディタなど、あらゆるアプリのウィンドウをカードとして管理し、ワンクリックでアクセス・配置・操作できる。

## 技術スタック

- **フロントエンド**: React 18, TypeScript, Vite, @dnd-kit
- **バックエンド**: Electron (CommonJS), プラットフォーム抽象化レイヤー
- **対応OS**: macOS / Windows / Linux
- **配布**: electron-builder → DMG (macOS) / NSIS (Windows) / AppImage+deb (Linux)
- **CI/CD**: GitHub Actions で全プラットフォーム自動ビルド

---

## 機能一覧

### 1. カンバンボード

#### マルチタブボード
- アプリ種別ごとにタブで分離（Terminal、Finder、Chrome、VS Code 等）
- タブの追加・削除・並べ替え
- インストール済みアプリの自動検出とタブ候補表示
- Web系ブラウザ（Chrome, Safari, Firefox, Vivaldi, Arc, Edge, Brave）のビルトイン対応

#### カラム管理
- デフォルト3カラム: 「未着手」「実行中」「完了」
- カラムの追加・削除・名前変更
- カラムごとのカスタムカラー設定
- カラムの一時非表示
- カラム間でのドラッグ&ドロップ並べ替え

#### カード管理
- カードの作成・編集・削除
- カード情報: タイトル、説明文、完了コメント
- サブタグ（複数選択: 研究・雑務・その他 + カスタムタグ）
- 優先順位（高・中・低 + カスタム優先度の追加）
- ステータスマーカー（空白 / x / > / < / − / // / ! / ? / i / d）
- カラム内・カラム間のドラッグ&ドロップ移動
- 右クリックコンテキストメニュー

### 2. ウィンドウ管理

#### ウィンドウリンク
- カードにOSのウィンドウを紐づけ
- 1カードに複数ウィンドウをリンク可能（Terminal + Finder + ブラウザ等）
- ウィンドウ選択モーダルでアプリ切り替えタブ付きの一覧表示
- 重複リンクの自動防止

#### ウィンドウジャンプ
- カードクリックまたはウィンドウ行クリックで対象ウィンドウを前面化
- 最小化（Dock格納）されたウィンドウの自動復帰
- 3種類のアクティベーションアニメーション:
  - **ポップ**: 縮小→拡大の弾むエフェクト
  - **最小化復帰**: Dock最小化→ジニーエフェクトで復帰
  - **スライド**: 斜め下にスライド→元位置に戻る

#### ウィンドウ操作
- UIからウィンドウを閉じる
- ウィンドウのリンク解除（カードから切り離し）
- リンク切れウィンドウの再リンク（履歴から選択可能）
- 新規ウィンドウの作成（Terminal / Finder / 任意アプリ）

#### リアルタイム監視
- 10秒間隔でウィンドウの生存チェック
- リンク切れ検出: 全ウィンドウ消失でカード赤表示、部分消失は該当行のみ赤
- フォーカス復帰時の3秒デバウンスチェック
- 5秒キャッシュで重複API呼び出しを抑制

### 3. Grid配置

#### 単一アプリGrid
- 選択アプリのウィンドウをディスプレイ上にグリッド状に整列
- 自動グリッドサイズ計算（ウィンドウ数に応じて最適化）
- カスタム行・列・パディング指定
- カラム別フィルタリング（特定カラムのウィンドウだけ配置）
- プラグインによるプリセットレイアウト対応

#### マルチアプリGrid
- 複数アプリのウィンドウを1つの画面分割で同時配置
- お気に入り構成の保存・呼び出し
- マルチディスプレイ対応（自動配置 or ディスプレイ指定）

### 4. タイマー・時間計測

- カード説明文内のチェックボックス行にタイマーを紐づけ
- 開始・一時停止・終了・キャンセル操作
- 自動記録: `⏱ YYYY/MM/DD HH:MM-HH:MM (Xh Ym)` 形式で説明文に追記
- プラグインによるカスタムタイマーアクション対応

### 5. アーカイブ

- 完了カードのアーカイブ保存
- 日時ごとのグループ化表示
- アーカイブからボードへの復元
- アーカイブビューア

### 6. 日報エクスポート

- **ビルトインフォーマット**: Markdown / JSON / Plain Text
- タブ・ステータスでフィルター（完了のみ、進行中のみ等）
- 日付フィルター（当日のログのみ抽出）
- **Obsidian連携**: Vault内のDaily Noteに自動挿入（マーカー指定可能）
- プラグインによるカスタムフォーマット追加

### 7. アイデア帳

- 思いついたアイデアを一時保存
- カテゴリ分類: feature（機能）・improvement（改善）・bug（バグ）・other
- カテゴリごとの折りたたみ表示
- ボードへの直接復元（カードとして追加）

### 8. バックアップ・復元

#### 自動バックアップ
- 1分ごとに自動保存
- ローテーション保護（.prev.json で世代管理）

#### 手動バックアップ（3種類）
- **全データバックアップ**: ボード・カード・設定・ログ全て
- **設定プリセット**: 個人情報を除外して共有可能
- **カードデータ**: カード・ボード・ログのみ（設定はそのまま）

#### インポート
- JSONファイルからの復元
- 旧形式データの自動マイグレーション（べき等処理）

### 9. Terminal固有機能（macOS）

- **背景色変更**: カラム色・優先順位色・グラデーション・プリセットカラーで設定
- カード内の全Terminalウィンドウに一括適用
- ttyパスによる安定的なウィンドウ追跡
- 実行中コマンドのプレビュー表示

### 10. プラグインシステム

#### プラグイン種別
- **grid-layout**: Grid配置のプリセットレイアウト
- **export**: 日報エクスポートのカスタムフォーマット
- **utility**: ユーティリティ機能
- **integration**: 外部サービス連携
- **theme**: テーマ（予約済み）

#### プラグイン管理
- GitHubリポジトリからワンクリックインストール（owner/repo形式）
- バージョン管理・自動アップデート検出
- 有効化・無効化・アンインストール
- マニフェストベースの設定管理

### 11. カスタマイズ設定

#### 基本設定
- テーマ: ダーク / ライト
- カードクリック動作: 編集 / ジャンプ
- ウィンドウアニメーション: ポップ / 最小化復帰 / スライド
- ウィンドウ閉じる確認ダイアログ: ON / OFF

#### コンテンツ管理
- サブタグの名前・色カスタマイズ
- カスタムサブタグの追加・編集・削除
- カスタム優先順位の追加
- アプリタブの管理

#### 統合設定
- Obsidian Vault パス・Daily Note パス・挿入マーカー設定

### 12. リマインダー通知

- 未追加ウィンドウの検出と通知
- リンク切れカードの警告表示
- トースト通知による操作結果フィードバック

### 13. アップデート機能

- 起動時の自動バージョンチェック（GitHub API）
- ダウンロード進捗表示（MB単位）
- ワンクリックインストール・自動再起動
- macOS: DMG → ditto + quarantine除去
- Windows: NSISインストーラー起動
- Linux: AppImage / deb

### 14. キーボードショートカット

| ショートカット | 動作 |
|--------------|------|
| ⌘ , | 設定を開く |
| ⌘ W | ウィンドウを閉じる |
| Esc | モーダルを閉じる |
| ⌘ Z | 元に戻す |
| Tab / Shift+Tab | エディタのインデント |
| Enter | 編集モーダルで保存 |

---

## クロスプラットフォーム対応

| 機能 | macOS | Windows | Linux |
|------|-------|---------|-------|
| ウィンドウ検出 | AppleScript | PowerShell + user32.dll | wmctrl + xdotool |
| ウィンドウ前面化 | AXRaise + NSRunningApplication | SetForegroundWindow | wmctrl -a |
| Grid配置 | AppleScript + NSScreen | PowerShell + SetWindowPos | wmctrl -e |
| アプリスキャン | /Applications スキャン + sips | レジストリ + スタートメニュー | .desktop ファイル |
| Terminal色変更 | AppleScript | 非対応 | 非対応 |
| アニメーション | pop / minimize / dock | pop のみ | なし |

## ディレクトリ構成

```
electron/                  # Electronメインプロセス (.cjs)
  main.cjs                 # エントリポイント、IPC定義
  preload.cjs              # contextBridge API公開
  pluginManager.cjs        # プラグイン管理
  pluginAPI.cjs            # プラグインAPI
  platforms/
    index.cjs              # プラットフォーム振り分け
    darwin/                # macOS実装
    win32/                 # Windows実装
    linux/                 # Linux実装
src/
  components/              # Reactコンポーネント
    Board.tsx              # メインボード
    Card.tsx               # カード（2段構成: 情報 + ウィンドウリスト）
    Column.tsx             # カラム
    EditCardModal.tsx      # カード編集モーダル
    WindowSelectModal.tsx  # ウィンドウ選択（タブ切替付き）
    GridArrangeModal.tsx   # Grid配置モーダル
    MultiGridModal.tsx     # マルチアプリGrid
    RelinkWindowModal.tsx  # ウィンドウ再リンク
    ExportModal.tsx        # 日報エクスポート
    SettingsModal.tsx      # 設定モーダル
    HelpModal.tsx          # ヘルプモーダル
    ArchiveViewer.tsx      # アーカイブビューア
    IdeaBacklog.tsx        # アイデア帳
    PluginManager.tsx      # プラグイン管理
    ReminderNotification.tsx # リマインダー通知
    settings/              # 設定サブコンポーネント
  hooks/                   # カスタムフック
    useCardOperations.ts   # カード操作ロジック
    useWindowStatus.ts     # ウィンドウ状態管理
    useDataPersistence.ts  # データ永続化
  types/index.ts           # 型定義
  utils/boardUtils.ts      # ボードユーティリティ
  styles/App.css           # スタイル（ダーク/ライト両対応）
build/                     # アプリアイコン
scripts/                   # リリーススクリプト
.github/workflows/         # CI/CD
```

## 将来計画

| 機能 | 概要 | 備考 |
|------|------|------|
| カード単位Grid配置 | 1カードに紐づく全ウィンドウ（異なるアプリ含む）をまとめてGrid配置 | v1.9.0で複数ウィンドウ対応済み、Grid拡張として |
| Finder背景色変更 | Terminal色変更と同様に、Finderウィンドウの背景色をカード/カラム色で設定 | Finder.appは背景色APIを持たないため、代替手段の調査が必要（オーバーレイウィンドウ等） |

## バージョン履歴（主要）

- **v1.9.1** - 最小化復帰アニメーション修正
- **v1.9.0** - 1カード複数ウィンドウ対応、ウィンドウ選択タブ
- **v1.8.x** - Dock風スライドアニメーション、マルチディスプレイ対応
- **v1.7.x** - Grid配置カラムフィルタリング、アクセシビリティ権限チェック
- **v1.6.x** - プラグインシステム、アプリアイコン、カスタムカラーピッカー

## リポジトリ

https://github.com/lutelute/AtelierX
